

#####解决方案

- 问题：可靠性——从创建订单服务失败中恢复
- 解决方案概要：考虑不同场景下的错误恢复，使用本地服务中的错误恢复机制实现故障转移
- 因素
1.  在使用外部服务（如支付授权）时出现错误的健壮恢复
2.  在请求远程数据库数据失败时的健壮恢复
- 解决方案
1.  重复请求：幂等控制(一个操作，不论执行多少次，产生的效果和返回的结果都是一样的)，如，在第二次支付前提示第一次支付成功，阻止重复支付；
2.  预扣减库存失败：预创建订单过程中，库存数量变化导致创建失败，订单由定时补偿机制定时删除
3.  订单创建消息发送失败：由于服务/资源响应超时、处理中断等原因导致订单数据同步失败，库存服务定时轮询处理数据(需要考虑事务处理时间,将超过某个时间范围该事务还处于预处理状态的订单筛选出来),询问订单服务改订单Id对应的订单是否创建成功,根据订单创建成功与否选取相应的事务补偿机制
4.  订单实际创建失败：订单的预处理数据通过订单的定时补偿机制删除，提示用户下单失败，系统同步订单数据，如果已支付进行自动退款处理
- 动机：在购票系统中，订单创建过程可能出现各种失败场景，要保证系统在高并发条件下能正确处理预定支付数据，防止系统崩溃
- 未解决问题：无
- 其他可供选择的方案：购买远程信用授权付的金牌质量服务协议来提高可靠性。可行，但过于昂贵。


- 问题：法律——遵守支付授权服务协议
- 解决方案概述：信用卡和借记卡支付处理
- 因素
当支付授权服务批准了信用卡或借记卡支付手，将由支付授权服务而不是买方来负责对卖方的支付。因此此对于每笔支付，卖方都需要将授权服务的未付金额记录于其应收账户下。通常，授权服务在每晚执行电子转账操作，将卖方当天的应收总额转入其账户下，同时对每笔交易扣除（少量的）服务费。
- 动机：
在销售交易中必须遵从所有税务规则。
- 未解决问题：
无
- 其他方案：
无
